<div class="container mt-4">
  <h2 *ngIf="!isEdicao">Cadastrar Novo Aluno</h2>
  <h2 *ngIf="isEdicao">Editar Aluno (ID: {{ alunoId }})</h2>

  <form *ngIf="cursos.length > 0 && turmas.length > 0 && diagnosticos.length > 0" [formGroup]="form" (ngSubmit)="onSubmit()">

    <div class="mb-3">
      <label for="nome" class="form-label">Nome Completo</label>
      <input type="text" id="nome" class="form-control" formControlName="nome">
      <div *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched" class="text-danger">
        Nome é obrigatório e deve ter pelo menos 3 caracteres.
      </div>
    </div>

    <div class="mb-3">
      <label for="matricula" class="form-label">Matrícula</label>
      <input type="text" id="matricula" class="form-control" formControlName="matricula">
       <div *ngIf="form.get('matricula')?.invalid && form.get('matricula')?.touched" class="text-danger">
        Matrícula é obrigatória.
      </div>
    </div>

    <div class="mb-3">
      <label for="nomeSocial" class="form-label">Nome Social (Opcional)</label>
      <input type="text" id="nomeSocial" class="form-control" formControlName="nomeSocial">
    </div>

    <div class="mb-3">
      <label for="cursoId" class="form-label">Curso</label>
      <select id="cursoId" class="form-select" formControlName="cursoId">
        <option [ngValue]="null" disabled>Selecione...</option>
        <option *ngFor="let curso of cursos" [ngValue]="curso.id">{{ curso.nome }}</option>
      </select>
       <div *ngIf="form.get('cursoId')?.invalid && form.get('cursoId')?.touched" class="text-danger">
        Curso é obrigatório.
      </div>
    </div>

    <div class="mb-3">
      <label for="turmaId" class="form-label">Turma</label>
      <select id="turmaId" class="form-select" formControlName="turmaId">
        <option [ngValue]="null" disabled>Selecione...</option>
        <option *ngFor="let turma of turmas" [ngValue]="turma.id">{{ turma.nome }}</option>
      </select>
      <div *ngIf="form.get('turmaId')?.invalid && form.get('turmaId')?.touched" class="text-danger">
        Turma é obrigatória.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label">Diagnósticos (Selecione um ou mais)</label>
      <div *ngFor="let diag of diagnosticos" class="form-check">
        <input
          class="form-check-input"
          type="checkbox"
          [value]="diag.id"
          [id]="'diag-' + diag.id"
          [checked]="diagnosticoSelecionado(diag.id!)"
          (change)="onDiagnosticoChange($event)">
        <label class="form-check-label" [for]="'diag-' + diag.id">
          {{ diag.nome }} ({{ diag.sigla || 'N/A' }})
        </label>
      </div>
    </div>

    <div class="mb-3 form-check">
      <input type="checkbox" id="prioridade" class="form-check-input" formControlName="prioridadeAtendimento">
      <label for="prioridade" class="form-check-label">Prioridade de Atendimento</label>
    </div>

    <hr>
    <button type="submit" class="btn btn-primary" [disabled]="form.invalid">Salvar</button>
    <a [routerLink]="['/alunos']" class="btn btn-secondary ms-2">Cancelar</a>
  </form>

  <div *ngIf="cursos.length === 0 || turmas.length === 0 || diagnosticos.length === 0">
      Carregando dados...
  </div>
</div>
