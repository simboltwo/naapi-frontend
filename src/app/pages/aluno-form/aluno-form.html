<div class="container mt-4">
   <div class="card">
     <div class="card-header naapi-card-header">
       <h2 *ngIf="!isEdicao" class="mb-0 fs-5">Cadastrar Novo Aluno</h2> <h2 *ngIf="isEdicao" class="mb-0 fs-5">Editar Aluno (ID: {{ alunoId }})</h2>
     </div>
     <div class="card-body">
       <form *ngIf="cursos.length > 0 && turmas.length > 0 && diagnosticos.length > 0; else loadingData" [formGroup]="form" (ngSubmit)="onSubmit()">

          <div class="mb-3">
            <label for="nome" class="form-label">Nome Completo</label>
            <input type="text" id="nome" class="form-control" formControlName="nome">
            <div *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched" class="text-danger small mt-1">
              Nome é obrigatório e deve ter pelo menos 3 caracteres.
            </div>
          </div>

          <div class="mb-3">
            <label for="matricula" class="form-label">Matrícula</label>
            <input type="text" id="matricula" class="form-control" formControlName="matricula">
            <div *ngIf="form.get('matricula')?.invalid && form.get('matricula')?.touched" class="text-danger small mt-1">
              Matrícula é obrigatória.
            </div>
          </div>

          <div class="mb-3">
            <label for="nomeSocial" class="form-label">Nome Social (Opcional)</label>
            <input type="text" id="nomeSocial" class="form-control" formControlName="nomeSocial">
          </div>

          <div class="row mb-3"> <div class="col-md-6">
                  <label for="cursoId" class="form-label">Curso</label>
                  <select id="cursoId" class="form-select" formControlName="cursoId">
                    <option [ngValue]="null" disabled>Selecione...</option>
                    <option *ngFor="let curso of cursos" [ngValue]="curso.id">{{ curso.nome }}</option>
                  </select>
                  <div *ngIf="form.get('cursoId')?.invalid && form.get('cursoId')?.touched" class="text-danger small mt-1">
                    Curso é obrigatório.
                  </div>
              </div>
               <div class="col-md-6">
                  <label for="turmaId" class="form-label">Turma</label>
                  <select id="turmaId" class="form-select" formControlName="turmaId">
                    <option [ngValue]="null" disabled>Selecione...</option>
                    <option *ngFor="let turma of turmas" [ngValue]="turma.id">{{ turma.nome }}</option>
                  </select>
                  <div *ngIf="form.get('turmaId')?.invalid && form.get('turmaId')?.touched" class="text-danger small mt-1">
                    Turma é obrigatória.
                  </div>
               </div>
          </div>

          <div class="mb-3">
            <label class="form-label d-block">Diagnósticos (Selecione um ou mais)</label> <div class="diagnosticos-grid"> <div *ngFor="let diag of diagnosticos" class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [value]="diag.id"
                      [id]="'diag-' + diag.id"
                      [checked]="diagnosticoSelecionado(diag.id!)"
                      (change)="onDiagnosticoChange($event)">
                    <label class="form-check-label" [for]="'diag-' + diag.id">
                      {{ diag.nome }} {{ diag.sigla ? '(' + diag.sigla + ')' : '' }}
                    </label>
                </div>
             </div>
          </div>

          <div class="mb-4 form-check"> <input type="checkbox" id="prioridade" class="form-check-input" formControlName="prioridadeAtendimento">
            <label for="prioridade" class="form-check-label">Prioridade de Atendimento</label>
          </div>

          <hr>
          <div class="d-flex justify-content-end"> <button type="submit" class="btn btn-primary me-2" [disabled]="form.invalid">
                <i class="bi bi-save me-1"></i> Salvar
             </button>
             <a [routerLink]="['/alunos']" class="btn btn-secondary">
                <i class="bi bi-x-circle me-1"></i> Cancelar
             </a>
          </div>
       </form>

       <ng-template #loadingData>
          <div class="text-center p-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando dados...</span>
              </div>
              <p class="mt-2 text-muted">Carregando dados necessários...</p>
          </div>
        </ng-template>

     </div> </div> </div>
